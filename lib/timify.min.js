(function(m,a){"function"===typeof define&&define.amd?define([],a):"object"===typeof exports?module.exports=a():m.timify=a()})(this,function(){function m(a,g){function f(a,b,c,f,d,e,l,h){b=b||0;c=c||0;f=f||1;d=d||0;e=e||0;l=l||0;h=h||0;a=parseFloat(a||0);c=parseInt(c);c=0<c?c-1:0;k._offset=a;return 0==a?(new Date(b,c,f,d,e,l,h)).getTime():(new Date((new Date(b,c,f,d,e,l,h)).getTime()+36E5*a)).getTime()}var k=this;Date.now||(Date.now=function(){return(new Date).getTime()});g=new Date;var p=g.getUTCFullYear(),e=g.getUTCMonth(),l=g.getUTCDate();this._setdate=function(a){if("undefined"===typeof a)return Date.now();var b=a.split(" ");var c=~b[0].indexOf("-")?b[0].split("-"):~b[0].indexOf(".")?b[0].split("."):~b[0].indexOf("/")?b[0].split("/"):[b[0]];if("undefined"===typeof c&&"today"!=b[0]&&"now"!=b[0])throw Error("input error on first parameter");if(1===b.length){if("today"==b[0])return f(0,p,e,l);if("now"==b[0])return Date.now();if(1===c.length)return f(0,c[0]);if(2===c.length)return f(0,c[0],c[1]);if(3===c.length)return f(0,c[0],c[1],c[2])}else if(2===b.length)if("+"==b[1].charAt(0)||"-"==b[1].charAt(0)){if("today"==b[0])return f(b[1],p,e,l);if("now"==b[0])return Date.now()+36E5*parseFloat(b[1]);if(1===c.length)return f(b[1],c[0]);if(2===c.length)return f(b[1],c[0],c[1]);if(3===c.length)return f(b[1],c[0],c[1],c[2])}else{a=b[1].split(":");if("today"==b[0]){if(1===a.length)return f(0,p,e,l,a[0]);if(2===a.length)return f(0,p,e,l,a[0],a[1]);if(3===s3.length)return f(0,p,e,l,a[0],a[1],a[2])}if(1===a.length)return f(0,c[0],c[1],c[2],a[0]);if(2===a.length)return f(0,c[0],c[1],c[2],a[0],a[1]);if(3===a.length)return f(0,c[0],c[1],c[2],a[0],a[1],a[2])}else if(3===b.length)if(a=b[1].split(":"),"today"==b[0]){if(1===a.length)return f(b[2],p,e,l,a[0]);if(2===a.length)return f(b[2],p,e,l,a[0],a[1]);if(3===a.length)return f(b[2],p,e,l,a[0],a[1],a[2])}else{if(3===c.length&&1===a.length)return f(b[2],c[0],c[1],c[2],a[0]);if(3===c.length&&2===a.length)return f(b[2],c[0],c[1],c[2],a[0],a[1]);if(3===c.length&&3===a.length)return f(b[2],c[0],c[1],c[2],a[0],a[1],a[2])}else throw Error("input error on first parameter");};if("undefined"!==typeof a)if(a instanceof Date)k._date=a.getTime();else if("number"===typeof a)k._date=a;else if("string"===typeof a)k._date=k._setdate(a);else throw Error("input error on first parameter");else k._date=!1;this.setMode=function(a){if("string"===typeof a)if("undefined"===typeof k._mode)k._mode=a;else throw Error("instance of script was already created; previous mode: "+k._mode+"; please create another one");else throw Error("mode setting failed");};this._events={};this.doEvent=function(a){if("function"===typeof k._events[a])k._events[a]()}}m.prototype.date=function(a,g){var f=this;var k=["January February March April May June July August September October November December".split(" "),"jan. feb. mar. apr. may june july aug. sept. oct. nov. dec.".split(" ")];var p={Y:"year",M:"month",N:"fullMonth",n:"shortMonth",W:"week",D:"day",h:"hour",m:"min",s:"sec"};if("object"!==typeof a||!(a instanceof Object))throw Error("first parameter needs to be an object");if(!1===f._date)throw Error("this method requires a date on the timify function");if("undefined"!==typeof a.type){if("print"==a.type){f.setMode("print");"string"!==typeof a.format&&(a.format="%DD; %NN; %YYYY; %hh;:%mm;:%ss;");if("undefined"!==typeof a.months&&a.months instanceof Array)if(12===a.months.length)k[0]=a.months;else throw Error("the 'Months' array needs to be exactly 12 length");if("undefined"!==typeof a.shMonths&&a.shMonths instanceof Arrayif(12===a.shMonths.length)k[1]=a.shMonths;else throw Error("the 'shMonths' array needs to be exactly 12 length");var e=new Date(f._date),l={};l.year=e.getFullYear();l.month=e.getMonth()+1;l.fullMonth=k[0][l.month-1];l.shortMonth=k[1][l.month-1];l.week=parseInt(e.getDate()/7);l.day=e.getDate();l.hour=e.getHours();l.min=e.getMinutes();l.sec=e.getSeconds();k=a.format.replace(/%[a-zA-Z](.*?);/g,function(){var a;var b=[].slice.call(arguments)[0];b=b.replace(/(^%)|(;$)/g,"");~b.indexOf("(")&&(a=b.split("(")[1].split(")")[0].split(","));b=b.split("(")[0];var c=b.charAt(b.length-1);b=b.charAt(0);b=l[p[b]];isNaN(b)||10>b&&(b="0"+b);if("undefined"===typeof a)return b;if(1==a.length)return"-"==c?a[0]+b:b+a[0];if(2==a.length)return"-"==c?1==b?a[0]+b:a[1]+b:1==b?b+a[0]:b+a[1]});"object"===typeof a.element&&(a.element.innerHTML=k);"function"===typeof g&&g(k)}if("round"==a.type)if(f.setMode("round"),f._roundfunc=function(){function e(c){l=1==b[c].split(",").length?a.format.replace("%s",h[c]+" "+b[c]):1==h[c]?a.format.replace("%s",h[c]+" "+b[c].split(",")[0]):a.format.replace("%s",h[c]+" "+b[c].split(",")[1])}var b={s:"second,seconds",m:"minute,minutes",h:"hour,hours",D:"day,days",W:"week,weeks",M:"month,months",Y:"year,years"},c;"undefined"===typeof a.format&&(a.format="about %s ago");"undefined"===typeof a.order&&(a.order="s,m,h,D,W,M,Y");if("undefined"!==typeof a.text){if("object"!==typeof a.text)throw Error("the text parameter needs to be an object");for(i in a.text)b[i]=a.text[i]}"undefined"!==typeof a.from?a.from instanceof Date?c=a.from:"number"===typeof a.from?c=new Date(a.from):"string"===typeof a.from&&(c=new Date(f._setdate(a.from))):c=new Date;var l="",d=a.order.split(","),k=new Date(f._date),g=Math.floor(Math.abs((c.getTime()-f._date)/1E3)),h={};h.s=g;h.m=Math.floor(g/60);h.h=Math.floor(h.m/60);h.D=Math.floor(h.h/24);h.W=Math.floor(h.D/7);h.M=Math.abs(function(a,c){return 12*(c.getUTCFullYear()-a.getUTCFullYear())-(a.getUTCMonth()+1)+(c.getUTCMonth()+1)}(k,c));h.Y=Math.abs(c.getFullYear()-k.getFullYear());c=d.indexOf("s");k=d.indexOf("m");g=d.indexOf("h");var p=d.indexOf("D"),m=d.indexOf("W"),r=d.indexOf("M"),q=d.indexOf("Y");~c&&(!d[c+1]||d[c+1]&&0==h[d[c+1]])?e("s"):~k&&(!d[k+1]||d[k+1]&&0==h[d[k+1]])?e("m"):~g&&(!d[g+1]||d[g+1]&&0==h[d[g+1]])?e("h"):~p&&(!d[p+1]||d[p+1]&&0==h[d[p+1]])?e("D"):~m&&(!d[m+1]||d[m+1]&&0==h[d[m+1]])?e("W"):~r&&(!d[r+1]||d[r+1]&&0==h[d[r+1]])?e("M"):~q&&(!d[q+1]||d[q+1]&&0==h[d[q+1]])&&e("Y");d={};d.round=l;d.data={};d.data.seconds=h.s;d.data.minutes=h.m;d.data.hours=h.h;d.data.days=h.D;d.data.weeks=h.W;d.data.months=h.M;d.data.years=h.Y;return d},"number"===typeof a.update){if(0>=a.update)throw Error("update time parameter needs to be greater than 0");"undefined"!==typeof a.from?(k=f._roundfunc(),console.warn("Ignored the update time for performance reasons (if the 'from' parameter is specified then the date will be the same everytime)"),"object"===typeof a.element&&(a.element.innerHTML=k.round),"function"===typeof g&&g(k)):(f._updatefunc=function(){var e=f._roundfunc();"object"===typeof a.element&&(a.element.innerHTML=e.round);"function"===typeof g&&g(e);f.doEvent("update")},f._updatetime=a.update,f._updateint=setInterval(f._updatefunc,a.update),f._updatefunc())}else k=f._roundfunc(),"object"===typeof a.element&&(a.element.innerHTML=k.round),"function"===typeof g&&g(k)}else throw Error("type must be specified in options");};m.prototype.countdown=function(a,g){function f(a,c){return 12*(c.getUTCFullYear()-a.getUTCFullYear())-(a.getUTCMonth()+1)+(c.getUTCMonth()+1)}function k(a,c){var b="YMWDhms".split("");return b.indexOf(a)<b.indexOf(c)?-1:1}var p,e=this;this.setMode("countdown");if(!1===e._date)throw Error("this method requires a date defined on the timify function");if("undefined"===typeof a)throw Error("the first parameter needs to be an object");"undefined"===typeof a.format&&(a.format="%h; %m; %s;");"undefined"!==typeof a.continue&&1==a.continue&&(p=!1);var l=new Date(e._date);e._timefunc=function(){function b(){var a,b=[].slice.call(arguments)[0];b=b.replace(/(^%)|(;$)/g,"");~b.indexOf("(")&&(a=b.split("(")[1].split(")")[0].split(","));b=b.split("(")[0];var d=b.charAt(b.length-1),e=b.charAt(0);if(0==c)return g.push(e),b;if(1==c){b=n[e];if("undefined"===typeof a)return b;if(1==a.length)return"-"==d?a[0]+b:b+a[0];if(2==a.length)return"-"==d?1==b?a[0]+b:a[1]+b:1==b?b+a[0]:b+a[1]}}var c=!1,g=[],d;"undefined"!==typeof a.from?a.from instanceof Date?d=a.from:"number"===typeof a.from?d=new Date(a.from):"string"===typeof a.from&&(d=new Date(e._setdate(a.from))):d=new Date;var m=Math.floor(Math.abs((e._date-d.getTime())/1E3));var p=Math.floor(m/60);var h=Math.floor(p/60);var t=Math.floor(h/24);var u=Math.floor(t/7);var r=Math.abs(f(l,d));d=Math.abs(l.getFullYear()-d.getFullYear());var q=m,n={s:null,m:null,h:null,D:null,W:null,M:null,Y:null};a.format.replace(/%[a-zA-Z](.*?);/g,b);g.sort(k);c=!0;~g.indexOf("Y")&&(n.Y=Math.floor(q/3600/24/365.25),q-=Math.floor(31557600*n.Y));~g.indexOf("M")&&(n.M=Math.floor(q/3600/24/30.4375),q-=Math.floor(2629800*n.M));~g.indexOf("W")&&(n.W=Math.floor(q/3600/24/7),q-=Math.floor(604800*n.W));~g.indexOf("D")&&(n.D=Math.floor(q/3600/24),q-=Math.floor(86400*n.D));~g.indexOf("h")&&(n.h=Math.floor(q/3600),q-=Math.floor(3600*n.h));~g.indexOf("m")&&(n.m=Math.floor(q/60),q-=Math.floor(60*n.m));~g.indexOf("s")&&(n.s=Math.floor(q),q-=Math.floor(n.s));return{text:a.format.replace(/%[a-zA-Z](.*?);/g,b),years:n.Y,months:n.M,weeks:n.W,days:n.D,hours:n.h,minutes:n.m,seconds:n.s,full:{years:d,months:r,weeks:u,days:t,hours:h,minutes:p,seconds:m}}};if("undefined"===typeof a.from)if("undefined"===typeof a.update&&(a.update=!1),a.update)e._updatefunc=function(){var b=e._timefunc();"undefined"!==typeof p&&0==b.full.seconds&&e._updatetime&&e._updatefunc?(clearInterval(e._updateint),e._updateint=void 0,e._updatetime=void 0,e._updatefunc=void 0,e.doEvent("finish")):("object"===typeof a.element&&(a.element.innerHTML=b.text),"function"===typeof g&&g(b),e.doEvent("update"))},e._updatetime=a.update,e._updateint=setInterval(e._updatefunc,a.update),e._updatefunc();else{var m=e._timefunc();"object"===typeof a.element&&(a.element.innerHTML=m.text);"function"===typeof g&&g(m)}else m=e._timefunc(),"number"===typeof a.update&&console.warn("Ignored the update time for performance reasons (if the 'from' parameter is specified then the date will be the same everytime)"),"object"===typeof a.element&&(a.element.innerHTML=m.text),"function"===typeof g&&g(m)};m.prototype.stopwatch=function(){this.setMode("stopwatch")};m.prototype.on=function(a,g){var f={countdown:["stop","update","finish","resume","pause"],stopwatch:["stop","pause","start","update","resume"],round:["stop","pause","update","resume"]};if("undefined"===typeof this._mode)throw Error("You need to create an instance of the script to attach events.");if("undefined"===typeof f[this._mode])throw Error("can't attach events to this method");if(~f[this._mode].indexOf(a))if("function"===typeof g)this._events[a]=g;else throw Error("the callback needs to be a function");else throw Error("event not recognized for this method");};m.prototype.off=function(a){"undefined"!==typeof this._events[a]&&delete this._events[a]};m.prototype.pause=function(){"round"!=this._mode&&"countdown"!=this._mode||!this._updatetime||"number"!==typeof this._updateint||(clearInterval(this._updateint),this._updateint=void 0,this._paused=!0,this.doEvent("pause"))};m.prototype.resume=function(){("round"==this._mode||"countdown"==this._mode)&&this._updatetime&&this._updatefunc&&this._paused&&(this._updateint=setInterval(this._updatefunc,this._updatetime),this._paused=void 0,this.doEvent("resume"),this._updatefunc())};m.prototype.stop=function(){("round"==this._mode||"countdown"==this._mode)&&this._updatetime&&this._updatefunc&&(this._paused?this._paused=void 0:this._updateint&&(clearInterval(this._updateint),this._updateint=void 0),this._updatefunc=this._updatetime=void 0,this.doEvent("stop"))};m.prototype.start=function(){};return m});
